var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,r,h){g!=Array.prototype&&g!=Object.prototype&&(g[r]=h.value)};$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(g,r,h,x){if(r){h=$jscomp.global;g=g.split(".");for(x=0;x<g.length-1;x++){var F=g[x];F in h||(h[F]={});h=h[F]}g=g[g.length-1];x=h[g];r=r(x);r!=x&&null!=r&&$jscomp.defineProperty(h,g,{configurable:!0,writable:!0,value:r})}};$jscomp.polyfill("Math.sign",function(g){return g?g:function(g){g=Number(g);return 0===g||isNaN(g)?g:0<g?1:-1}},"es6","es3");
(function(g){"object"===typeof exports&&"undefined"!==typeof module?module.exports=g():"function"===typeof define&&define.amd?define([],g):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).imsc=g()})(function(){return function(){function g(r,h,x){function F(l,G){if(!h[l]){if(!r[l]){var b="function"==typeof require&&require;if(!G&&b)return b(l,!0);if(k)return k(l,!0);G=Error("Cannot find module '"+l+"'");throw G.code="MODULE_NOT_FOUND",G;}G=
h[l]={exports:{}};r[l][0].call(G.exports,function(b){return F(r[l][1][b]||b)},G,G.exports,g,r,h,x)}return h[l].exports}for(var k="function"==typeof require&&require,l=0;l<x.length;l++)F(x[l]);return F}return g}()({1:[function(g,r,h){(function(x,g,k,l,h){function F(a,c){var b=a.styleAttrs&&a.styleAttrs["http://www.w3.org/ns/ttml#styling backgroundColor"];if("span"===a.kind)!b&&c&&(a.styleAttrs||(a.styleAttrs={}),a.styleAttrs["http://www.w3.org/ns/ttml#styling backgroundColor"]=c);else if(b&&delete a.styleAttrs["http://www.w3.org/ns/ttml#styling backgroundColor"],
a.contents)for(var f=0;f<a.contents.length;f++)F(a.contents[f],b||c)}function b(a){if("contents"in a){var c="styleAttrs"in a?a.styleAttrs[l.byName.ruby.qname]:null;c="span"===a.kind&&("container"===c||"textContainer"===c||"baseContainer"===c);for(var f=a.contents.length-1;0<=f;f--)!c||"styleAttrs"in a.contents[f]&&l.byName.ruby.qname in a.contents[f].styleAttrs?b(a.contents[f]):delete a.contents[f]}}function d(a,c,b,f){var H=f&&"seq"===f.timeContainer,q=0;f&&(q=H&&b?b.end:f.begin);c.begin=c.explicit_begin?
c.explicit_begin+q:q;b=c.begin;f=null;for(var D in c.sets)d(a,c.sets[D],f,c),b="seq"===c.timeContainer?c.sets[D].end:Math.max(b,c.sets[D].end),f=c.sets[D];if("contents"in c)for(var e in c.contents)d(a,c.contents[e],f,c),b="seq"===c.timeContainer?c.contents[e].end:Math.max(b,c.contents[e].end),f=c.contents[e];else b=H?c.begin:Number.POSITIVE_INFINITY;c.end=null!==c.explicit_end&&null!==c.explicit_dur?Math.min(c.begin+c.explicit_dur,q+c.explicit_end):null===c.explicit_end&&null!==c.explicit_dur?c.begin+
c.explicit_dur:null!==c.explicit_end&&null===c.explicit_dur?q+c.explicit_end:b;delete c.explicit_begin;delete c.explicit_dur;delete c.explicit_end;a._registerEvent(c)}function A(a){this.node=a}function e(){this.events=[];this.head=new a;this.body=null}function a(){this.styling=new c;this.layout=new t}function c(){this.styles={};this.initials={}}function f(){this.styleRefs=this.styleAttrs=this.id=null}function q(){this.styleAttrs=null}function t(){this.regions={}}function R(a,c){this.kind="image";
this.src=a;this.type=c}function n(a){this.id=a}function B(a){this.regionID=a}function I(a){this.styleAttrs=a}function u(a){this.sets=a}function J(a){this.contents=a}function p(a,c,b){this.explicit_begin=a;this.explicit_end=c;this.explicit_dur=b}function v(){this.kind="body"}function O(){this.kind="div"}function E(){this.kind="p"}function r(){this.kind="span"}function z(){this.kind="span"}function P(){this.kind="br"}function K(){}function W(){}function y(a){var c=null;a&&(a=a.attributes["xml:id"]||
a.attributes.id)&&(c=a.value||null);return c}function S(a){return a&&"style"in a.attributes?a.attributes.style.value.split(" "):[]}function T(a,c){var b={};if(null!==a)for(var f in a.attributes){var d=a.attributes[f].uri+" "+a.attributes[f].local,q=l.byQName[d];if(void 0!==q){var e=q.parse(a.attributes[f].value);null!==e?(b[d]=e,q===l.byName.zIndex&&M(c,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):L(c,"Cannot parse styling attribute "+d+" --\x3e "+a.attributes[f].value)}}return b}
function N(a,c,b){for(var f in a.attributes)if(a.attributes[f].uri===c&&a.attributes[f].local===b)return a.attributes[f].value;return null}function aa(a,c){a=N(a,k.ns_tts,"extent");if(null===a)return null;var b=a.split(" ");if(2!==b.length)return M(c,"Malformed extent (ignoring)"),null;a=h.parseLength(b[0]);b=h.parseLength(b[1]);return b&&a?{h:b,w:a}:(M(c,"Malformed extent values (ignoring)"),null)}function U(a,c,b){var f=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/,d=/^(\d{2,}):(\d\d):(\d\d):(\d{2,})$/,
q=/^(\d+(?:\.\d+)?)t$/,e=/^(\d+(?:\.\d+)?)ms$/,H=/^(\d+(?:\.\d+)?)s$/,D=/^(\d+(?:\.\d+)?)h$/,w=/^(\d+(?:\.\d+)?)m$/,t,k=null;null!==(t=/^(\d+(?:\.\d+)?)f$/.exec(b))?null!==c&&(k=parseFloat(t[1])/c):null!==(t=q.exec(b))?null!==a&&(k=parseFloat(t[1])/a):null!==(t=e.exec(b))?k=parseFloat(t[1])/1E3:null!==(t=H.exec(b))?k=parseFloat(t[1]):null!==(t=D.exec(b))?k=3600*parseFloat(t[1]):null!==(t=w.exec(b))?k=60*parseFloat(t[1]):null!==(t=f.exec(b))?k=3600*parseInt(t[1])+60*parseInt(t[2])+parseFloat(t[3]):
null!==(t=d.exec(b))&&null!==c&&(k=3600*parseInt(t[1])+60*parseInt(t[2])+parseInt(t[3])+(null===t[4]?0:parseInt(t[4])/c));return k}function X(a,c,b){for(;0<c.styleRefs.length;){var f=c.styleRefs.pop();f in a.styles?(X(a,a.styles[f],b),V(a.styles[f].styleAttrs,c.styleAttrs)):L(b,"Non-existant style id referenced")}}function Y(a,c,b,f){for(var d=c.length-1;0<=d;d--){var q=c[d];q in a.styles?V(a.styles[q].styleAttrs,b):L(f,"Non-existant style id referenced")}}function V(a,c){for(var b in a)b in c||(c[b]=
a[b])}function M(a,c){if(a&&a.warn&&a.warn(c))throw c;}function L(a,c){if(a&&a.error&&a.error(c))throw c;}function C(a,c){a&&a.fatal&&a.fatal(c);throw c;}function Z(a,c){for(var b=0,f=a.length-1,d;b<=f;){d=Math.floor((b+f)/2);var q=a[d];if(q<c)b=d+1;else if(q>c)f=d-1;else return{found:!0,index:d}}return{found:!1,index:b}}x.fromXML=function(H,w,D){var u=g.parser(!0,{xmlns:!0}),m=[],n=[],x=[],B=0,h=null;u.onclosetag=function(a){if(m[0]instanceof c)for(var b in m[0].styles)X(m[0],m[0].styles[b],w);else if(m[0]instanceof
E||m[0]instanceof r){if(1<m[0].contents.length){a=[m[0].contents[0]];for(b=1;b<m[0].contents.length;b++)m[0].contents[b]instanceof z&&a[a.length-1]instanceof z?a[a.length-1].text+=m[0].contents[b].text:a.push(m[0].contents[b]);m[0].contents=a}m[0]instanceof r&&1===m[0].contents.length&&m[0].contents[0]instanceof z&&(m[0].text=m[0].contents[0].text,delete m[0].contents)}else if(m[0]instanceof A)if(m[0].node.uri===k.ns_tt&&"metadata"===m[0].node.local)B--;else if(0<B&&D&&"onCloseTag"in D)D.onCloseTag();
x.shift();n.shift();m.shift()};u.ontext=function(a){if(void 0!==m[0])if(m[0]instanceof r||m[0]instanceof E){if(m[0]instanceof r){var c=m[0].styleAttrs[l.byName.ruby.qname];if("container"===c||"textContainer"===c||"baseContainer"===c)return}c=new z;c.initFromText(h,m[0],a,x[0],w);m[0].contents.push(c)}else if(m[0]instanceof A&&0<B&&D&&"onText"in D)D.onText(a)};u.onopentag=function(b){function d(a){k.ttaf_map[a.uri]&&(a.uri=k.ttaf_map[a.uri])}var H=b.attributes["xml:space"];H?x.unshift(H.value):0===
x.length?x.unshift("default"):x.unshift(x[0]);(H=b.attributes["xml:lang"])?n.unshift(H.value):0===n.length?n.unshift(""):n.unshift(n[0]);d(b);if(b.attributes)for(var u in b.attributes)b.attributes.hasOwnProperty(u)&&d(b.attributes[u]);if(b.uri===k.ns_tt)if("tt"===b.local)null!==h&&C(w,"Two <tt> elements at ("+this.line+","+this.column+")"),h=new e,h.initFromNode(b,w),m.unshift(h);else if("head"===b.local)m[0]instanceof e||C(w,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),
m.unshift(h.head);else if("styling"===b.local)m[0]instanceof a||C(w,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),m.unshift(h.head.styling);else if("style"===b.local)if(m[0]instanceof c){var g=new f;g.initFromNode(b,w);g.id?h.head.styling.styles[g.id]=g:L(w,"<style> element missing @id attribute");m.unshift(g)}else m[0]instanceof K?(g=new f,g.initFromNode(b,w),V(g.styleAttrs,m[0].styleAttrs),m.unshift(g)):C(w,"Parent of <style> element is not <styling> or <region> at ("+
this.line+","+this.column+")");else if("initial"===b.local)if(m[0]instanceof c){u=new q;u.initFromNode(b,w);for(g in u.styleAttrs)h.head.styling.initials[g]=u.styleAttrs[g];m.unshift(u)}else C(w,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")");else if("layout"===b.local)m[0]instanceof a||C(w,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),m.unshift(h.head.layout);else if("region"===b.local)m[0]instanceof t||C(w,"Parent of <region> element is not <layout> at "+
this.line+","+this.column+")"),g=new K,g.initFromNode(h,b,w),!g.id||g.id in h.head.layout.regions?L(w,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):h.head.layout.regions[g.id]=g,m.unshift(g);else if("body"===b.local)m[0]instanceof e||C(w,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==h.body&&C(w,"Second <body> element at "+this.line+","+this.column+")"),g=new v,g.initFromNode(h,b,w),h.body=g,m.unshift(g);else if("div"===b.local){m[0]instanceof
O||m[0]instanceof v||C(w,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");g=new O;g.initFromNode(h,m[0],b,w);if(u=g.styleAttrs[l.byName.backgroundImage.qname])g.contents.push(new R(u)),delete g.styleAttrs[l.byName.backgroundImage.qname];m[0].contents.push(g);m.unshift(g)}else"image"===b.local?(m[0]instanceof O||C(w,"Parent of <image> element is not <div> at "+this.line+","+this.column+")"),g=new R,g.initFromNode(h,m[0],b,w),m[0].contents.push(g),m.unshift(g)):"p"===
b.local?(m[0]instanceof O||C(w,"Parent of <p> element is not <div> at "+this.line+","+this.column+")"),g=new E,g.initFromNode(h,m[0],b,w),m[0].contents.push(g),m.unshift(g)):"span"===b.local?(m[0]instanceof r||m[0]instanceof E||C(w,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")"),g=new r,g.initFromNode(h,m[0],b,x[0],w),m[0].contents.push(g),m.unshift(g)):"br"===b.local?(m[0]instanceof r||m[0]instanceof E||C(w,"Parent of <br> element is not <span> or <p> at "+this.line+
","+this.column+")"),g=new P,g.initFromNode(h,m[0],b,w),m[0].contents.push(g),m.unshift(g)):"set"===b.local?(m[0]instanceof r||m[0]instanceof E||m[0]instanceof O||m[0]instanceof v||m[0]instanceof K||m[0]instanceof P||C(w,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")"),g=new W,g.initFromNode(h,m[0],b,w),m[0].sets.push(g),m.unshift(g)):m.unshift(new A(b));else m.unshift(new A(b));if(m[0]instanceof A)if(b.uri===k.ns_tt&&"metadata"===b.local)B++;else if(0<
B&&D&&"onOpenTag"in D){g=[];for(var Q in b.attributes)g[b.attributes[Q].uri+" "+b.attributes[Q].local]={uri:b.attributes[Q].uri,local:b.attributes[Q].local,value:b.attributes[Q].value};D.onOpenTag(b.uri,b.local,g)}};u.write(H).close();delete h.head.styling.styles;H=!1;for(var p in h.head.layout.regions){H=!0;break}H||(p=K.prototype.createDefaultRegion(h,w),h.head.layout.regions[p.id]=p);for(var I in h.head.layout.regions)d(h,h.head.layout.regions[I],null,null);h.body&&d(h,h.body,null,null);h.body&&
b(h.body);h.body&&F(h.body);return h};e.prototype.initFromNode=function(a,b){var c=N(a,k.ns_ttp,"cellResolution"),f=15;var d=32;null!==c&&(c=/(\d+) (\d+)/.exec(c),null!==c?(d=parseInt(c[1]),f=parseInt(c[2])):M(b,"Malformed cellResolution value (using initial value instead)"));this.cellLength={h:new h.ComputedLength(0,1/f),w:new h.ComputedLength(1/d,0)};f=N(a,k.ns_ttp,"frameRate");c=30;null!==f&&(d=/(\d+)/.exec(f),null!==d?c=parseInt(d[1]):M(b,"Malformed frame rate attribute (using initial value instead)"));
d=N(a,k.ns_ttp,"frameRateMultiplier");var q=1;null!==d&&(d=/(\d+) (\d+)/.exec(d),null!==d?q=parseInt(d[1])/parseInt(d[2]):M(b,"Malformed frame rate multiplier attribute (using initial value instead)"));c*=q;q=1;d=N(a,k.ns_ttp,"tickRate");null===d?null!==f&&(q=c):(d=/(\d+)/.exec(d),null!==d?q=parseInt(d[1]):M(b,"Malformed tick rate attribute (using initial value instead)"));this.effectiveFrameRate=c;this.tickRate=q;d=N(a,k.ns_ittp,"aspectRatio");null===d&&(d=N(a,k.ns_ttp,"displayAspectRatio"));f=null;
null!==d&&(c=/(\d+)\s+(\d+)/.exec(d),null!==c?(d=parseInt(c[1]),c=parseInt(c[2]),0!==d&&0!==c?f=d/c:L(b,"Illegal aspectRatio values (ignoring)")):L(b,"Malformed aspectRatio attribute (ignoring)"));this.aspectRatio=f;f=N(a,k.ns_ttp,"timeBase");null!==f&&"media"!==f&&C(b,"Unsupported time base");a=aa(a,b);null===a?this.pxLength={h:null,w:null}:("px"===a.h.unit&&"px"===a.w.unit||C(b,"Extent on TT must be in px or absent"),this.pxLength={h:new h.ComputedLength(0,1/a.h.value),w:new h.ComputedLength(1/
a.w.value,0)});this.dimensions={h:new h.ComputedLength(0,1),w:new h.ComputedLength(1,0)}};e.prototype._registerEvent=function(a){if(!(a.end<=a.begin)){var c=Z(this.events,a.begin);c.found||this.events.splice(c.index,0,a.begin);a.end!==Number.POSITIVE_INFINITY&&(c=Z(this.events,a.end),c.found||this.events.splice(c.index,0,a.end))}};e.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]};e.prototype.getMediaTimeEvents=function(){return this.events};f.prototype.initFromNode=
function(a,c){this.id=y(a);this.styleAttrs=T(a,c);this.styleRefs=S(a)};q.prototype.initFromNode=function(a,c){this.styleAttrs={};for(var b in a.attributes)if(a.attributes[b].uri===k.ns_itts||a.attributes[b].uri===k.ns_ebutts||a.attributes[b].uri===k.ns_tts)this.styleAttrs[a.attributes[b].uri+" "+a.attributes[b].local]=a.attributes[b].value};R.prototype.initFromNode=function(a,c,b,f){(this.src="src"in b.attributes?b.attributes.src.value:null)||L(f,"Invalid image@src attribute");(this.type="type"in
b.attributes?b.attributes.type.value:null)||L(f,"Invalid image@type attribute");I.prototype.initFromNode.call(this,a,c,b,f);p.prototype.initFromNode.call(this,a,c,b,f);u.prototype.initFromNode.call(this,a,c,b,f);B.prototype.initFromNode.call(this,a,c,b,f)};n.prototype.initFromNode=function(a,c,b,f){this.id=y(b)};B.prototype.initFromNode=function(a,c,b,f){this.regionID=b&&"region"in b.attributes?b.attributes.region.value:""};I.prototype.initFromNode=function(a,c,b,f){this.styleAttrs=T(b,f);null!==
a.head&&null!==a.head.styling&&Y(a.head.styling,S(b),this.styleAttrs,f)};u.prototype.initFromNode=function(a,b,c,f){this.sets=[]};J.prototype.initFromNode=function(a,b,c,f){this.contents=[]};p.prototype.initFromNode=function(a,b,c,f){b=null;c&&"begin"in c.attributes&&(b=U(a.tickRate,a.effectiveFrameRate,c.attributes.begin.value),null===b&&M(f,"Malformed begin value "+c.attributes.begin.value+" (using 0)"));var d=null;c&&"dur"in c.attributes&&(d=U(a.tickRate,a.effectiveFrameRate,c.attributes.dur.value),
null===d&&M(f,"Malformed dur value "+c.attributes.dur.value+" (ignoring)"));var q=null;c&&"end"in c.attributes&&(q=U(a.tickRate,a.effectiveFrameRate,c.attributes.end.value),null===q&&M(f,"Malformed end value (ignoring)"));this.explicit_begin=b;this.explicit_end=q;this.explicit_dur=d;(a=c&&"timeContainer"in c.attributes?c.attributes.timeContainer.value:null)&&"par"!==a?"seq"===a?f="seq":(L(f,"Illegal value of timeContainer (assuming 'par')"),f="par"):f="par";this.timeContainer=f};v.prototype.initFromNode=
function(a,c,b){I.prototype.initFromNode.call(this,a,null,c,b);p.prototype.initFromNode.call(this,a,null,c,b);u.prototype.initFromNode.call(this,a,null,c,b);B.prototype.initFromNode.call(this,a,null,c,b);J.prototype.initFromNode.call(this,a,null,c,b)};O.prototype.initFromNode=function(a,c,b,f){I.prototype.initFromNode.call(this,a,c,b,f);p.prototype.initFromNode.call(this,a,c,b,f);u.prototype.initFromNode.call(this,a,c,b,f);B.prototype.initFromNode.call(this,a,c,b,f);J.prototype.initFromNode.call(this,
a,c,b,f)};E.prototype.initFromNode=function(a,c,b,f){I.prototype.initFromNode.call(this,a,c,b,f);p.prototype.initFromNode.call(this,a,c,b,f);u.prototype.initFromNode.call(this,a,c,b,f);B.prototype.initFromNode.call(this,a,c,b,f);J.prototype.initFromNode.call(this,a,c,b,f)};r.prototype.initFromNode=function(a,c,b,f,d){I.prototype.initFromNode.call(this,a,c,b,d);p.prototype.initFromNode.call(this,a,c,b,d);u.prototype.initFromNode.call(this,a,c,b,d);B.prototype.initFromNode.call(this,a,c,b,d);J.prototype.initFromNode.call(this,
a,c,b,d);this.space=f};z.prototype.initFromText=function(a,c,b,f,d){p.prototype.initFromNode.call(this,a,c,null,d);this.text=b;this.space=f};P.prototype.initFromNode=function(a,c,b,f){B.prototype.initFromNode.call(this,a,c,b,f);p.prototype.initFromNode.call(this,a,c,b,f)};K.prototype.createDefaultRegion=function(a,c){var b=new K;b.id="";I.prototype.initFromNode.call(b,a,null,{name:"region",attributes:{"tts:displayAlign":{name:"tts:displayAlign",value:"after",prefix:"tts",local:"displayAlign",uri:"http://www.w3.org/ns/ttml#styling"},
"tts:extent":{name:"tts:extent",value:"80% 20%",prefix:"tts",local:"extent",uri:"http://www.w3.org/ns/ttml#styling"},"tts:origin":{name:"tts:origin",value:"10% 70%",prefix:"tts",local:"origin",uri:"http://www.w3.org/ns/ttml#styling"},"tts:overflow":{name:"tts:overflow",value:"visible",prefix:"tts",local:"overflow",uri:"http://www.w3.org/ns/ttml#styling"}},ns:{"":"http://www.w3.org/ns/ttml",ebuttm:"urn:ebu:tt:metadata",ebutts:"urn:ebu:tt:style",ittp:"http://www.w3.org/ns/ttml/profile/imsc1#parameter",
itts:"http://www.w3.org/ns/ttml/profile/imsc1#styling",ttm:"http://www.w3.org/ns/ttml#metadata",ttp:"http://www.w3.org/ns/ttml#parameter",tts:"http://www.w3.org/ns/ttml#styling",xml:"http://www.w3.org/XML/1998/namespace"},prefix:"",local:"region",uri:"http://www.w3.org/ns/ttml",isSelfClosing:!0},c);b.sets=[];p.call(b,0,Number.POSITIVE_INFINITY,null);return b};K.prototype.initFromNode=function(a,c,b){n.prototype.initFromNode.call(this,a,null,c,b);I.prototype.initFromNode.call(this,a,null,c,b);p.prototype.initFromNode.call(this,
a,null,c,b);u.prototype.initFromNode.call(this,a,null,c,b);null!==a.head&&null!==a.head.styling&&Y(a.head.styling,S(c),this.styleAttrs,b)};W.prototype.initFromNode=function(a,c,b,f){p.prototype.initFromNode.call(this,a,c,b,f);a=T(b,f);this.value=this.qname=null;for(var d in a){if(this.qname){L(f,"More than one style specified on set");break}this.qname=d;this.value=a[d]}}})("undefined"===typeof h?this.imscDoc={}:h,"undefined"===typeof sax?g("sax"):sax,"undefined"===typeof imscNames?g("./names"):imscNames,
"undefined"===typeof imscStyles?g("./styles"):imscStyles,"undefined"===typeof imscUtils?g("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7,sax:void 0}],2:[function(g,r,h){(function(g,h,k){function x(a,c,f){if("region"===f.kind){var d=document.createElement("div");d.style.position="absolute"}else if("body"===f.kind)d=document.createElement("div");else if("div"===f.kind)d=document.createElement("div");else if("image"===f.kind){if(d=document.createElement("img"),null!==a.imgResolver&&null!==
f.src){var e=a.imgResolver(f.src,d);e&&(d.src=e);d.height=a.regionH;d.width=a.regionW}}else if("p"===f.kind)d=document.createElement("p");else if("span"===f.kind){if("container"===f.styleAttrs[k.byName.ruby.qname])d=document.createElement("ruby"),a.ruby=!0;else if("base"===f.styleAttrs[k.byName.ruby.qname])d=document.createElement("rb");else if("text"===f.styleAttrs[k.byName.ruby.qname])d=document.createElement("rt");else if("baseContainer"===f.styleAttrs[k.byName.ruby.qname])d=document.createElement("rbc");
else if("textContainer"===f.styleAttrs[k.byName.ruby.qname])d=document.createElement("rtc");else{if("delimiter"===f.styleAttrs[k.byName.ruby.qname])return;d=document.createElement("span")}(e=f.styleAttrs[k.byName.textEmphasis.qname])&&"none"!==e.style&&(a.textEmphasis=!0)}else"br"===f.kind&&(d=document.createElement("br"));if(d){c.appendChild(d);d.style.margin="0";for(var g in A)c=A[g],e=f.styleAttrs[c.qname],void 0!==e&&null!==c.map&&c.map(a,d,f,e);g=d;if("region"===f.kind)if(c=f.styleAttrs[k.byName.writingMode.qname],
"lrtb"===c||"lr"===c)a.ipd="lr",a.bpd="tb";else if("rltb"===c||"rl"===c)a.ipd="rl",a.bpd="tb";else if("tblr"===c)a.ipd="tb",a.bpd="lr";else if("tbrl"===c||"tb"===c)a.ipd="tb",a.bpd="rl";(c=f.styleAttrs[k.byName.linePadding.qname])&&!c.isZero()&&(e=c.toUsedLength(a.w,a.h),0<e&&(e=Math.ceil(e)+"px","tb"===a.bpd?(g.style.paddingLeft=e,g.style.paddingRight=e):(g.style.paddingTop=e,g.style.paddingBottom=e),a.lp=c));(c=f.styleAttrs[k.byName.multiRowAlign.qname])&&"auto"!==c&&(g=document.createElement("span"),
g.style.display="inline-block",g.style.textAlign=c,d.appendChild(g),a.mra=c);(c=f.styleAttrs[k.byName.rubyReserve.qname])&&"none"!==c[0]&&(a.rubyReserve=c);f.styleAttrs[k.byName.fillLineGap.qname]&&(a.flg=!0);if("span"===f.kind&&f.text)if(k.byName.textCombine.qname in f.styleAttrs&&"all"===f.styleAttrs[k.byName.textCombine.qname][0])d.textContent=f.text;else for(c="",e=0;e<f.text.length;e++){c+=f.text.charAt(e);var n=f.text.charCodeAt(e);if(55296>n||56319<n||e===f.text.length)n=document.createElement("span"),
n.textContent=c,d.appendChild(n),c=""}for(var h in f.contents)x(a,g,f.contents[h]);h=[];if((a.lp||a.mra||a.flg||a.ruby||a.textEmphasis||a.rubyReserve)&&"p"===f.kind){b(a,g,h,null);if(a.rubyReserve){for(c=0;c<h.length;c++){e=document.createElement("ruby");n=document.createElement("rb");n.textContent="\u200b";e.appendChild(n);var l=a.rubyReserve[1].toUsedLength(a.w,a.h)+"px";if("both"===a.rubyReserve[0]){n=document.createElement("rtc");n.style.rubyPosition="under";n.textContent="\u200b";n.style.fontSize=
l;var u=document.createElement("rtc");u.style.rubyPosition="over";u.textContent="\u200b";u.style.fontSize=l;e.appendChild(n);e.appendChild(u)}else n=document.createElement("rtc"),n.textContent="\u200b",n.style.fontSize=l,n.style.rubyPosition="after"===a.rubyReserve[0]||"outside"===a.rubyReserve[0]&&0<c?"tb"===a.bpd||"rl"===a.bpd?"under":"over":"tb"===a.bpd||"rl"===a.bpd?"over":"under",e.appendChild(n);h[c].elements[0].node.parentElement.insertBefore(e,h[c].elements[0].node)}a.rubyReserve=null}if(a.ruby||
a.rubyReserve){for(c=0;c<h.length;c++)for(e=0;e<h[c].rbc.length;e++)h[c].rbc[e].style.rubyPosition||(h[c].rbc[e].style.rubyPosition="tb"===a.bpd?0===c?"over":"under":"rl"===a.bpd?0===c?"over":"under":0===c?"under":"over");a.ruby=null}if(a.textEmphasis){for(c=0;c<h.length;c++)for(e=0;e<h[c].te.length;e++)h[c].te[e].style.textEmphasisPosition&&"none"!==h[c].te[e].style.textEmphasisPosition||(h[c].te[e].style.textEmphasisPosition="tb"===a.bpd?0===c?"left over":"left under":"rl"===a.bpd?0===c?"right under":
"left under":0===c?"left under":"right under");a.textEmphasis=null}if(a.mra){for(c=0;c<h.length-1;c++)n=h[c].elements.length,0!==n&&!1===h[c].br&&(e=document.createElement("br"),n=h[c].elements[n-1].node,n.parentElement.insertBefore(e,n.nextSibling));a.mra=null}if(a.lp){c=a.lp.toUsedLength(a.w,a.h);for(var J in h)e=h[J].elements[h[J].start_elem],n=h[J].elements[h[J].end_elem],u=Math.ceil(c)+"px",l="-"+Math.ceil(c)+"px",0!==h[J].elements.length&&("lr"===a.ipd?(e.node.style.borderLeftColor=e.bgcolor||
"#00000000",e.node.style.borderLeftStyle="solid",e.node.style.borderLeftWidth=u,e.node.style.marginLeft=l):"rl"===a.ipd?(e.node.style.borderRightColor=e.bgcolor||"#00000000",e.node.style.borderRightStyle="solid",e.node.style.borderRightWidth=u,e.node.style.marginRight=l):"tb"===a.ipd&&(e.node.style.borderTopColor=e.bgcolor||"#00000000",e.node.style.borderTopStyle="solid",e.node.style.borderTopWidth=u,e.node.style.marginTop=l),"lr"===a.ipd?(n.node.style.borderRightColor=n.bgcolor||"#00000000",n.node.style.borderRightStyle=
"solid",n.node.style.borderRightWidth=u,n.node.style.marginRight=l):"rl"===a.ipd?(n.node.style.borderLeftColor=n.bgcolor||"#00000000",n.node.style.borderLeftStyle="solid",n.node.style.borderLeftWidth=u,n.node.style.marginLeft=l):"tb"===a.ipd&&(n.node.style.borderBottomColor=n.bgcolor||"#00000000",n.node.style.borderBottomStyle="solid",n.node.style.borderBottomWidth=u,n.node.style.marginBottom=l));a.lp=null}if(a.flg){c=r(g.getBoundingClientRect(),a);J=c.before;c=c.after;e=Math.sign(c-J);for(n=0;n<=
h.length;n++){u=0===n?J:n===h.length?c:(h[n].before+h[n-1].after)/2;if(0<n)for(var p=0;p<h[n-1].elements.length;p++)if(null!==h[n-1].elements[p].bgcolor){var v=h[n-1].elements[p];0>e*(v.after-u)&&(l=Math.ceil(Math.abs(u-v.after))+"px",v.node.style.backgroundColor=v.bgcolor,"lr"===a.bpd?v.node.style.paddingRight=l:"rl"===a.bpd?v.node.style.paddingLeft=l:"tb"===a.bpd&&(v.node.style.paddingBottom=l))}if(n<h.length)for(p=0;p<h[n].elements.length;p++)v=h[n].elements[p],null!==v.bgcolor&&0<e*(v.before-
u)&&(l=Math.ceil(Math.abs(v.before-u))+"px",v.node.style.backgroundColor=v.bgcolor,"lr"===a.bpd?v.node.style.paddingLeft=l:"rl"===a.bpd?v.node.style.paddingRight=l:"tb"===a.bpd&&(v.node.style.paddingTop=l))}a.flg=null}}"region"===f.kind&&(b(a,g,h),"tb"===a.bpd&&a.enableRollUp&&0<f.contents.length&&"after"===f.styleAttrs[k.byName.displayAlign.qname]&&(f=new F(""===f.id?"_":f.id,h),a.currentISDState[f.id]=f,a.previousISDState&&f.id in a.previousISDState&&0<a.previousISDState[f.id].plist.length&&1<f.plist.length&&
f.plist[f.plist.length-2].text===a.previousISDState[f.id].plist[a.previousISDState[f.id].plist.length-1].text&&(a=d.firstElementChild,f=f.plist[f.plist.length-1].after-f.plist[f.plist.length-1].before,a.style.bottom="-"+f+"px",a.style.transition="transform 0.4s",a.style.position="relative",a.style.transform="translateY(-"+f+"px)")))}else if(a=a.errorHandler,f="Error processing ISD element kind: "+f.kind,a&&a.error&&a.error(f))throw f;}function F(a,c){this.id=a;this.plist=c}function r(a,c){var b={before:null,
after:null,start:null,end:null};"tb"===c.bpd?(b.before=a.top,b.after=a.bottom,"lr"===c.ipd?(b.start=a.left,b.end=a.right):(b.start=a.right,b.end=a.left)):"lr"===c.bpd?(b.before=a.left,b.after=a.right,b.start=a.top,b.end=a.bottom):"rl"===c.bpd&&(b.before=a.right,b.after=a.left,b.start=a.top,b.end=a.bottom);return b}function b(a,c,f,d){if("rt"!==c.localName&&"rtc"!==c.localName)if(d=c.style.backgroundColor||d,0===c.childElementCount)if("span"===c.localName||"rb"===c.localName){var e=c.getBoundingClientRect();
if(0!==e.height&&0!==e.width){a=r(e,a);if(!(e=0===f.length)){e=a.before;var q=a.after,g=f[f.length-1].before,k=f[f.length-1].after;e=!(q<k&&e>g||k<=q&&g>=e)}e?f.push({before:a.before,after:a.after,start:a.start,end:a.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1}):(e=Math.sign(a.after-a.before),q=Math.sign(a.end-a.start),0>e*(a.before-f[f.length-1].before)&&(f[f.length-1].before=a.before),0<e*(a.after-f[f.length-1].after)&&(f[f.length-1].after=a.after),0>q*(a.start-f[f.length-
1].start)&&(f[f.length-1].start=a.start,f[f.length-1].start_elem=f[f.length-1].elements.length),0<q*(a.end-f[f.length-1].end)&&(f[f.length-1].end=a.end,f[f.length-1].end_elem=f[f.length-1].elements.length));f[f.length-1].text+=c.textContent;f[f.length-1].elements.push({node:c,bgcolor:d,before:a.before,after:a.after})}}else"br"===c.localName&&0!==f.length&&(f[f.length-1].br=!0);else for(c=c.firstChild;c;)c.nodeType===Node.ELEMENT_NODE&&(b(a,c,f,d),"ruby"===c.localName||"rtc"===c.localName?0<f.length&&
f[f.length-1].rbc.push(c):"span"===c.localName&&c.style.textEmphasisStyle&&"none"!==c.style.textEmphasisStyle&&0<f.length&&f[f.length-1].te.push(c)),c=c.nextSibling}function d(a,b){this.qname=a;this.map=b}g.render=function(a,b,d,e,g,k,h,A,l){e=e||b.clientHeight;g=g||b.clientWidth;if(null!==a.aspectRatio){var c=e*a.aspectRatio;c>g?e=Math.round(g/a.aspectRatio):g=c}c=document.createElement("div");c.style.position="relative";c.style.width=g+"px";c.style.height=e+"px";c.style.margin="auto";c.style.top=
0;c.style.bottom=0;c.style.left=0;c.style.right=0;c.style.zIndex=0;d={h:e,w:g,regionH:null,regionW:null,imgResolver:d,displayForcedOnlyMode:k||!1,isd:a,errorHandler:h,previousISDState:A,enableRollUp:l||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};b.appendChild(c);for(var f in a.contents)x(d,c,a.contents[f]);return d.currentISDState};var A=[new d("http://www.w3.org/ns/ttml#styling backgroundColor",function(a,b,d,e){0!==e[3]&&(b.style.backgroundColor=
"rgba("+e[0].toString()+","+e[1].toString()+","+e[2].toString()+","+(e[3]/255).toString()+")")}),new d("http://www.w3.org/ns/ttml#styling color",function(a,b,d,e){b.style.color="rgba("+e[0].toString()+","+e[1].toString()+","+e[2].toString()+","+(e[3]/255).toString()+")"}),new d("http://www.w3.org/ns/ttml#styling direction",function(a,b,d,e){b.style.direction=e}),new d("http://www.w3.org/ns/ttml#styling display",function(a,b,d,e){}),new d("http://www.w3.org/ns/ttml#styling displayAlign",function(a,
b,d,e){b.style.display="flex";b.style.flexDirection="column";"before"===e?b.style.justifyContent="flex-start":"center"===e?b.style.justifyContent="center":"after"===e&&(b.style.justifyContent="flex-end")}),new d("http://www.w3.org/ns/ttml#styling extent",function(a,b,d,e){a.regionH=e.h.toUsedLength(a.w,a.h);a.regionW=e.w.toUsedLength(a.w,a.h);var c=e=0;if(d=d.styleAttrs["http://www.w3.org/ns/ttml#styling padding"])e=d[0].toUsedLength(a.w,a.h)+d[2].toUsedLength(a.w,a.h),c=d[1].toUsedLength(a.w,a.h)+
d[3].toUsedLength(a.w,a.h);b.style.height=a.regionH-e+"px";b.style.width=a.regionW-c+"px"}),new d("http://www.w3.org/ns/ttml#styling fontFamily",function(a,b,d,e){a=[];for(var c in e)e[c]=e[c].trim(),"monospaceSerif"===e[c]?(a.push("Courier New"),a.push('"Liberation Mono"'),a.push("Courier"),a.push("monospace")):"proportionalSansSerif"===e[c]||"default"===e[c]?(a.push("Arial"),a.push("Helvetica"),a.push('"Liberation Sans"'),a.push("sans-serif")):"monospace"===e[c]?a.push("monospace"):"sansSerif"===
e[c]?a.push("sans-serif"):"serif"===e[c]?a.push("serif"):"monospaceSansSerif"===e[c]?(a.push("Consolas"),a.push("monospace")):"proportionalSerif"===e[c]?a.push("serif"):a.push(e[c]);b.style.fontFamily=a.join(",")}),new d("http://www.w3.org/ns/ttml#styling shear",function(a,b,d,e){0!==e&&(d=-.9*e,b.style.transform="tb"===a.bpd?"skewX("+d+"deg)":"skewY("+d+"deg)")}),new d("http://www.w3.org/ns/ttml#styling fontSize",function(a,b,d,e){b.style.fontSize=e.toUsedLength(a.w,a.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling fontStyle",
function(a,b,d,e){b.style.fontStyle=e}),new d("http://www.w3.org/ns/ttml#styling fontWeight",function(a,b,d,e){b.style.fontWeight=e}),new d("http://www.w3.org/ns/ttml#styling lineHeight",function(a,b,d,e){b.style.lineHeight="normal"===e?"normal":e.toUsedLength(a.w,a.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling opacity",function(a,b,d,e){b.style.opacity=e}),new d("http://www.w3.org/ns/ttml#styling origin",function(a,b,d,e){b.style.top=e.h.toUsedLength(a.w,a.h)+"px";b.style.left=e.w.toUsedLength(a.w,
a.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling overflow",function(a,b,d,e){b.style.overflow=e}),new d("http://www.w3.org/ns/ttml#styling padding",function(a,b,d,e){d=[];d[0]=e[0].toUsedLength(a.w,a.h)+"px";d[1]=e[3].toUsedLength(a.w,a.h)+"px";d[2]=e[2].toUsedLength(a.w,a.h)+"px";d[3]=e[1].toUsedLength(a.w,a.h)+"px";b.style.padding=d.join(" ")}),new d("http://www.w3.org/ns/ttml#styling position",function(a,b,d,e){b.style.top=e.h.toUsedLength(a.w,a.h)+"px";b.style.left=e.w.toUsedLength(a.w,a.h)+
"px"}),new d("http://www.w3.org/ns/ttml#styling rubyAlign",function(a,b,d,e){b.style.rubyAlign=e}),new d("http://www.w3.org/ns/ttml#styling rubyPosition",function(a,b,d,e){if("before"===e||"after"===e)b.parentElement.style.rubyPosition="tb"===a.bpd?"before"===e?"over":"under":"rl"===a.bpd?"before"===e?"over":"under":"before"===e?"under":"over"}),new d("http://www.w3.org/ns/ttml#styling showBackground",null),new d("http://www.w3.org/ns/ttml#styling textAlign",function(a,b,d,e){a=d.styleAttrs[k.byName.direction.qname];
b.style.textAlign="start"===e?"rtl"===a?"right":"left":"end"===e?"rtl"===a?"left":"right":e}),new d("http://www.w3.org/ns/ttml#styling textDecoration",function(a,b,d,e){b.style.textDecoration=e.join(" ").replace("lineThrough","line-through")}),new d("http://www.w3.org/ns/ttml#styling textOutline",function(a,b,d,e){}),new d("http://www.w3.org/ns/ttml#styling textShadow",function(a,b,d,e){d=d.styleAttrs[k.byName.textOutline.qname];if("none"===e&&"none"===d)b.style.textShadow="";else{var c=[];"none"!==
d&&c.push("rgba("+d.color[0].toString()+","+d.color[1].toString()+","+d.color[2].toString()+","+(d.color[3]/255).toString()+") 0px 0px "+d.thickness.toUsedLength(a.w,a.h)+"px");if("none"!==e)for(var f in e)c.push(e[f].x_off.toUsedLength(a.w,a.h)+"px "+e[f].y_off.toUsedLength(a.w,a.h)+"px "+e[f].b_radius.toUsedLength(a.w,a.h)+"px rgba("+e[f].color[0].toString()+","+e[f].color[1].toString()+","+e[f].color[2].toString()+","+(e[f].color[3]/255).toString()+")");b.style.textShadow=c.join(",")}}),new d("http://www.w3.org/ns/ttml#styling textCombine",
function(a,b,d,e){b.style.textCombineUpright=e.join(" ")}),new d("http://www.w3.org/ns/ttml#styling textEmphasis",function(a,b,d,e){if("none"===e.style)b.style.textEmphasisStyle="none";else if(b.style.textEmphasisStyle="auto"===e.style?"filled":e.style+" "+e.symbol,"before"===e.position||"after"===e.position)b.style.textEmphasisPosition="tb"===a.bpd?"before"===e.position?"left over":"left under":"rl"===a.bpd?"before"===e.position?"right under":"left under":"before"===e.position?"left under":"right under"}),
new d("http://www.w3.org/ns/ttml#styling unicodeBidi",function(a,b,d,e){b.style.unicodeBidi="bidiOverride"===e?"bidi-override":e}),new d("http://www.w3.org/ns/ttml#styling visibility",function(a,b,d,e){b.style.visibility=e}),new d("http://www.w3.org/ns/ttml#styling wrapOption",function(a,b,d,e){b.style.whiteSpace="wrap"===e?"preserve"===d.space?"pre-wrap":"normal":"preserve"===d.space?"pre":"noWrap"}),new d("http://www.w3.org/ns/ttml#styling writingMode",function(a,b,d,e){if("lrtb"===e||"lr"===e)a.writingMode=
"horizontal-tb";else if("rltb"===e||"rl"===e)a.writingMode="horizontal-tb";else if("tblr"===e)a.writingMode="vertical-lr";else if("tbrl"===e||"tb"===e)a.writingMode="vertical-rl";b.style.writingMode=a.writingMode}),new d("http://www.w3.org/ns/ttml#styling zIndex",function(a,b,d,e){b.style.zIndex=e}),new d("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",function(a,b,d,e){a.displayForcedOnlyMode&&!1===e&&(b.style.visibility="hidden")})],e;for(e in A);})("undefined"===typeof h?this.imscHTML=
{}:h,"undefined"===typeof imscNames?g("./names"):imscNames,"undefined"===typeof imscStyles?g("./styles"):imscStyles,"undefined"===typeof imscUtils?g("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7}],3:[function(g,r,h){(function(g,h,k,l){function x(a,c,d,g,h,r,n,B,I){if(c<n.begin||c>=n.end)return null;r="regionID"in n&&""!==n.regionID?n.regionID:r;if(null!==h&&r!==d.id&&(!("contents"in n)||"contents"in n&&0===n.contents.length||""!==r))return null;var f=new A(n);for(q in n.sets)c<n.sets[q].begin||
c>=n.sets[q].end||(f.styleAttrs[n.sets[q].qname]=n.sets[q].value);var q={};for(var p in f.styleAttrs)if(q[p]=!0,p===k.byName.writingMode.qname&&!(k.byName.direction.qname in f.styleAttrs)){var v=f.styleAttrs[p];if("lrtb"===v||"lr"===v)f.styleAttrs[k.byName.direction.qname]="ltr";else if("rltb"===v||"rl"===v)f.styleAttrs[k.byName.direction.qname]="rtl"}if(null!==h)for(var t in k.all)if(p=k.all[t],p.qname===k.byName.textDecoration.qname){v=h.styleAttrs[p.qname];var E=f.styleAttrs[p.qname],G=[];void 0===
E?G=v:-1===E.indexOf("none")?((-1===E.indexOf("noUnderline")&&-1!==v.indexOf("underline")||-1!==E.indexOf("underline"))&&G.push("underline"),(-1===E.indexOf("noLineThrough")&&-1!==v.indexOf("lineThrough")||-1!==E.indexOf("lineThrough"))&&G.push("lineThrough"),(-1===E.indexOf("noOverline")&&-1!==v.indexOf("overline")||-1!==E.indexOf("overline"))&&G.push("overline")):G.push("none");f.styleAttrs[p.qname]=G}else p.qname!==k.byName.fontSize.qname||p.qname in f.styleAttrs||"span"!==f.kind||"textContainer"!==
f.styleAttrs[k.byName.ruby.qname]?p.qname!==k.byName.fontSize.qname||p.qname in f.styleAttrs||"span"!==f.kind||"text"!==f.styleAttrs[k.byName.ruby.qname]?p.inherit&&p.qname in h.styleAttrs&&!(p.qname in f.styleAttrs)&&(f.styleAttrs[p.qname]=h.styleAttrs[p.qname]):(v=h.styleAttrs[k.byName.fontSize.qname],f.styleAttrs[p.qname]="textContainer"===h.styleAttrs[k.byName.ruby.qname]?v:new l.ComputedLength(.5*v.rw,.5*v.rh)):(v=h.styleAttrs[k.byName.fontSize.qname],f.styleAttrs[p.qname]=new l.ComputedLength(.5*
v.rw,.5*v.rh));for(var z in k.all)(t=k.all[z],t.qname in f.styleAttrs||t.qname===k.byName.position.qname&&k.byName.origin.qname in f.styleAttrs||t.qname===k.byName.origin.qname&&k.byName.position.qname in f.styleAttrs||(p=a.head.styling.initials[t.qname]||t.initial,"region"!==f.kind&&(!1!==t.inherit||null===p)))||(f.styleAttrs[t.qname]=t.parse(p),q[t.qname]=!0);for(var P in k.all)if(z=k.all[P],z.qname in q&&null!==z.compute)if(t=z.compute(a,h,f,f.styleAttrs[z.qname],I),null!==t)f.styleAttrs[z.qname]=
t;else if(f.styleAttrs[z.qname]=z.compute(a,h,f,z.parse(z.initial),I),z="Style '"+z.qname+"' on element '"+f.kind+"' cannot be computed",B&&B.error&&B.error(z))throw z;if("none"===f.styleAttrs[k.byName.display.qname])return null;if(null===h)var K=null===g?[]:[g];else"contents"in n&&(K=n.contents);for(var R in K)h=x(a,c,d,g,f,r,K[R],B,I),null!==h&&f.contents.push(h.element);for(var y in f.styleAttrs)a=!1,"span"===f.kind&&(c=f.styleAttrs[k.byName.ruby.qname],(a=("container"===c||"textContainer"===c||
"baseContainer"===c)&&-1!==e.indexOf(y))||(a="container"!==c&&y===k.byName.rubyAlign.qname),a||(a=!("textContainer"===c||"text"===c)&&y===k.byName.rubyPosition.qname)),a||(a=-1===k.byQName[y].applies.indexOf(f.kind)),a&&delete f.styleAttrs[y];"span"===f.kind&&f.text&&"default"===f.space&&(y=f.text.replace(/[\t\r\n ]+/g," "),f.text=y);if("p"===f.kind){y=[];F(f,y);a=0;c="after_br";for(d=0;;)if("after_br"===c)a>=y.length||"br"===y[a].kind?(c="before_br",d=a,a--):("preserve"!==y[a].space&&(y[a].text=
y[a].text.replace(/^[\t\r\n ]+/g,"")),0<y[a].text.length?(c="looking_br",a++):y.splice(a,1));else if("before_br"===c)if(0>a||"br"===y[a].kind){if(c="after_br",a=d+1,a>=y.length)break}else if("preserve"!==y[a].space&&(y[a].text=y[a].text.replace(/[\t\r\n ]+$/g,"")),0<y[a].text.length){if(c="after_br",a=d+1,a>=y.length)break}else y.splice(a,1),a--;else a>=y.length||"br"===y[a].kind?(c="before_br",d=a,a--):a++;b(f)}return"div"===f.kind&&k.byName.backgroundImage.qname in f.styleAttrs||"br"===f.kind||
"image"===f.kind||"contents"in f&&0<f.contents.length||"span"===f.kind&&null!==f.text||"region"===f.kind&&"always"===f.styleAttrs[k.byName.showBackground.qname]?{region_id:r,element:f}:null}function F(a,b){if("contents"in a)for(var c in a.contents)F(a.contents[c],b);else"span"!==a.kind&&"br"!==a.kind||b.push(a)}function b(a){if("br"===a.kind)return!1;if("text"in a)return 0===a.text.length;if("contents"in a){for(var c=a.contents.length;c--;)b(a.contents[c])&&a.contents.splice(c,1);return 0===a.contents.length}}
function d(a){this.contents=[];this.aspectRatio=a.aspectRatio}function A(a){this.kind=a.kind||"region";a.id&&(this.id=a.id);this.styleAttrs={};for(var b in a.styleAttrs)this.styleAttrs[b]=a.styleAttrs[b];"src"in a&&(this.src=a.src);"type"in a&&(this.type=a.type);if("text"in a)this.text=a.text;else if("region"===this.kind||"contents"in a)this.contents=[];"space"in a&&(this.space=a.space)}g.generateISD=function(a,b,e){var c=new d(a),f={},g={},h=[];for(A in a.body)g[A]=a.body[A];g.contents=[];a.body.contents.forEach(function(a,
c){var d=a.contents.filter(function(a){return b<a.begin||b>=a.end?!1:(a.regionID&&h.push(a.regionID),!0)}),e={},f;for(f in a)e[f]=a[f];e.contents=d;g.contents[c]=e});for(var k in h){var A=x(a,b,a.head.layout.regions[h[k]],g,null,"",a.head.layout.regions[h[k]],e,f);null!==A&&c.contents.push(A.element)}return c};var e=[k.byName.color.qname,k.byName.textCombine.qname,k.byName.textDecoration.qname,k.byName.textEmphasis.qname,k.byName.textOutline.qname,k.byName.textShadow.qname]})("undefined"===typeof h?
this.imscISD={}:h,"undefined"===typeof imscNames?g("./names"):imscNames,"undefined"===typeof imscStyles?g("./styles"):imscStyles,"undefined"===typeof imscUtils?g("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7}],4:[function(g,r,h){h.generateISD=g("./isd").generateISD;h.fromXML=g("./doc").fromXML;h.renderHTML=g("./html").render},{"./doc":1,"./html":2,"./isd":3}],5:[function(g,r,h){g="undefined"===typeof h?this.imscNames={}:h;g.ns_tt="http://www.w3.org/ns/ttml";g.ns_tts="http://www.w3.org/ns/ttml#styling";
g.ns_ttp="http://www.w3.org/ns/ttml#parameter";g.ns_xml="http://www.w3.org/XML/1998/namespace";g.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling";g.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter";g.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt";g.ns_ebutts="urn:ebu:tt:style";g.ttaf_map={"http://www.w3.org/2006/10/ttaf1":g.ns_tt,"http://www.w3.org/2006/10/ttaf1#style":g.ns_tts,"http://www.w3.org/2006/10/ttaf1#parameter":g.ns_ttp}},{}],6:[function(g,r,h){(function(g,
h,k){function l(b,d,g,e,a,c,f,h){this.name=d;this.ns=b;this.qname=b+" "+d;this.inherit=a;this.animatable=c;this.initial=g;this.applies=e;this.parse=f;this.compute=h}g.all=[new l(h.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,k.parseColor,null),new l(h.ns_tts,"color","white",["span"],!0,!0,k.parseColor,null),new l(h.ns_tts,"direction","ltr",["p","span"],!0,!0,function(b){return b},null),new l(h.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,function(b){return b},
null),new l(h.ns_tts,"displayAlign","before",["region"],!1,!0,function(b){return b},null),new l(h.ns_tts,"extent","auto",["tt","region"],!1,!0,function(b){if("auto"===b)return b;var d=b.split(" ");if(2!==d.length)return null;b=k.parseLength(d[0]);return(d=k.parseLength(d[1]))&&b?{h:d,w:b}:null},function(b,d,g,e,a){if("auto"===e)d=new k.ComputedLength(0,1);else if(d=k.toComputedLength(e.h.value,e.h.unit,null,b.dimensions.h,null,b.pxLength.h),null===d)return null;if("auto"===e)b=new k.ComputedLength(1,
0);else if(b=k.toComputedLength(e.w.value,e.w.unit,null,b.dimensions.w,null,b.pxLength.w),null===b)return null;return{h:d,w:b}}),new l(h.ns_tts,"fontFamily","default",["span"],!0,!0,function(b){b=b.split(",");var d=[],g;for(g in b)"'"!==b[g].charAt(0)&&'"'!==b[g].charAt(0)?"default"===b[g]?d.push("monospaceSerif"):d.push(b[g]):d.push(b[g]);return d},null),new l(h.ns_tts,"shear","0%",["p"],!0,!0,k.parseLength,function(b,d,g,e){if("%"===e.unit)b=100<Math.abs(e.value)?100*Math.sign(e.value):e.value;
else return null;return b}),new l(h.ns_tts,"fontSize","1c",["span"],!0,!0,k.parseLength,function(b,d,h,e,a){return k.toComputedLength(e.value,e.unit,null!==d?d.styleAttrs[g.byName.fontSize.qname]:b.cellLength.h,null!==d?d.styleAttrs[g.byName.fontSize.qname]:b.cellLength.h,b.cellLength.h,b.pxLength.h)}),new l(h.ns_tts,"fontStyle","normal",["span"],!0,!0,function(b){return b},null),new l(h.ns_tts,"fontWeight","normal",["span"],!0,!0,function(b){return b},null),new l(h.ns_tts,"lineHeight","normal",["p"],
!0,!0,function(b){return"normal"===b?b:k.parseLength(b)},function(b,d,h,e,a){if("normal"===e)b=e;else if(b=k.toComputedLength(e.value,e.unit,h.styleAttrs[g.byName.fontSize.qname],h.styleAttrs[g.byName.fontSize.qname],b.cellLength.h,b.pxLength.h),null===b)return null;return b}),new l(h.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new l(h.ns_tts,"origin","auto",["region"],!1,!0,function(b){if("auto"===b)return b;var d=b.split(" ");if(2!==d.length)return null;b=k.parseLength(d[0]);return(d=k.parseLength(d[1]))&&
b?{h:d,w:b}:null},function(b,d,g,e,a){if("auto"===e)d=new k.ComputedLength(0,0);else if(d=k.toComputedLength(e.h.value,e.h.unit,null,b.dimensions.h,null,b.pxLength.h),null===d)return null;if("auto"===e)b=new k.ComputedLength(0,0);else if(b=k.toComputedLength(e.w.value,e.w.unit,null,b.dimensions.w,null,b.pxLength.w),null===b)return null;return{h:d,w:b}}),new l(h.ns_tts,"overflow","hidden",["region"],!1,!0,function(b){return b},null),new l(h.ns_tts,"padding","0px",["region"],!1,!0,function(b){b=b.split(" ");
if(4<b.length)return null;var d=[],g;for(g in b){var e=k.parseLength(b[g]);if(!e)return null;d.push(e)}return d},function(b,d,h,e,a){if(1===e.length)d=[e[0],e[0],e[0],e[0]];else if(2===e.length)d=[e[0],e[1],e[0],e[1]];else if(3===e.length)d=[e[0],e[1],e[2],e[1]];else if(4===e.length)d=[e[0],e[1],e[2],e[3]];else return null;e=h.styleAttrs[g.byName.writingMode.qname];if("lrtb"===e||"lr"===e)d=[d[0],d[3],d[2],d[1]];else if("rltb"===e||"rl"===e)d=[d[0],d[1],d[2],d[3]];else if("tblr"===e)d=[d[3],d[0],
d[1],d[2]];else if("tbrl"===e||"tb"===e)d=[d[3],d[2],d[1],d[0]];else return null;e=[];for(var c in d)if(0===d[c].value)e[c]=new k.ComputedLength(0,0);else if(e[c]=k.toComputedLength(d[c].value,d[c].unit,h.styleAttrs[g.byName.fontSize.qname],"0"===c||"2"===c?h.styleAttrs[g.byName.extent.qname].h:h.styleAttrs[g.byName.extent.qname].w,"0"===c||"2"===c?b.cellLength.h:b.cellLength.w,"0"===c||"2"===c?b.pxLength.h:b.pxLength.w),null===e[c])return null;return e}),new l(h.ns_tts,"position","top left",["region"],
!1,!0,function(b){return k.parsePosition(b)},function(b,d,h,e){d=k.toComputedLength(e.v.offset.value,e.v.offset.unit,null,new k.ComputedLength(-h.styleAttrs[g.byName.extent.qname].h.rw,b.dimensions.h.rh-h.styleAttrs[g.byName.extent.qname].h.rh),null,b.pxLength.h);if(null===d)return null;"bottom"===e.v.edge&&(d=new k.ComputedLength(-d.rw-h.styleAttrs[g.byName.extent.qname].h.rw,b.dimensions.h.rh-d.rh-h.styleAttrs[g.byName.extent.qname].h.rh));var a=k.toComputedLength(e.h.offset.value,e.h.offset.unit,
null,new k.ComputedLength(b.dimensions.w.rw-h.styleAttrs[g.byName.extent.qname].w.rw,-h.styleAttrs[g.byName.extent.qname].w.rh),null,b.pxLength.w);if(null===d)return null;"right"===e.h.edge&&(a=new k.ComputedLength(b.dimensions.w.rw-a.rw-h.styleAttrs[g.byName.extent.qname].w.rw,-a.rh-h.styleAttrs[g.byName.extent.qname].w.rh));return{h:d,w:a}}),new l(h.ns_tts,"ruby","none",["span"],!1,!0,function(b){return b},null),new l(h.ns_tts,"rubyAlign","center",["span"],!0,!0,function(b){return"center"!==b&&
"spaceAround"!==b?null:b},null),new l(h.ns_tts,"rubyPosition","outside",["span"],!0,!0,function(b){return b},null),new l(h.ns_tts,"rubyReserve","none",["p"],!0,!0,function(b){var d=b.split(" ");b=[null,null];if(0===d.length||2<d.length||"none"!==d[0]&&"both"!==d[0]&&"after"!==d[0]&&"before"!==d[0]&&"outside"!==d[0])return null;b[0]=d[0];if(2===d.length&&"none"!==d[0])if(d=k.parseLength(d[1]))b[1]=d;else return null;return b},function(b,d,h,e,a){if("none"===e[0])return e;b=null===e[1]?new k.ComputedLength(.5*
h.styleAttrs[g.byName.fontSize.qname].rw,.5*h.styleAttrs[g.byName.fontSize.qname].rh):k.toComputedLength(e[1].value,e[1].unit,h.styleAttrs[g.byName.fontSize.qname],h.styleAttrs[g.byName.fontSize.qname],b.cellLength.h,b.pxLength.h);return null===b?null:[e[0],b]}),new l(h.ns_tts,"showBackground","whenActive",["region"],!1,!0,function(b){return b},null),new l(h.ns_tts,"textAlign","start",["p"],!0,!0,function(b){return b},function(b,d,g,e,a){return"left"===e?"start":"right"===e?"end":e}),new l(h.ns_tts,
"textCombine","none",["span"],!0,!0,function(b){b=b.split(" ");return 1!==b.length||"none"!==b[0]&&"all"!==b[0]?null:[b[0]]},null),new l(h.ns_tts,"textDecoration","none",["span"],!0,!0,function(b){return b.split(" ")},null),new l(h.ns_tts,"textEmphasis","none",["span"],!0,!0,function(b){b=b.split(" ");var d={style:null,symbol:null,color:null,position:null},g;for(g in b)if("none"===b[g]||"auto"===b[g])d.style=b[g];else if("filled"===b[g]||"open"===b[g])d.style=b[g];else if("circle"===b[g]||"dot"===
b[g]||"sesame"===b[g])d.symbol=b[g];else if("current"===b[g])d.color=b[g];else if("outside"===b[g]||"before"===b[g]||"after"===b[g])d.position=b[g];else if(d.color=k.parseColor(b[g]),null===d.color)return null;null==d.style&&null==d.symbol?d.style="auto":(d.symbol=d.symbol||"circle",d.style=d.style||"filled");d.position=d.position||"outside";d.color=d.color||"current";return d},null),new l(h.ns_tts,"textOutline","none",["span"],!0,!0,function(b){if("none"===b)return b;var d={};b=b.split(" ");if(0===
b.length||2<b.length)return null;var g=k.parseColor(b[0]);d.color=g;null!==g&&b.shift();if(1!==b.length)return null;b=k.parseLength(b[0]);if(!b)return null;d.thickness=b;return d},function(b,d,h,e,a){if("none"===e)return e;d={};d.color=null===e.color?h.styleAttrs[g.byName.color.qname]:e.color;d.thickness=k.toComputedLength(e.thickness.value,e.thickness.unit,h.styleAttrs[g.byName.fontSize.qname],h.styleAttrs[g.byName.fontSize.qname],b.cellLength.h,b.pxLength.h);return null===d.thickness?null:d}),new l(h.ns_tts,
"textShadow","none",["span"],!0,!0,k.parseTextShadow,function(b,d,h,e){if("none"===e)return e;d=[];for(var a in e){var c={};c.x_off=k.toComputedLength(e[a][0].value,e[a][0].unit,null,h.styleAttrs[g.byName.fontSize.qname],null,b.pxLength.w);if(null===c.x_off)return null;c.y_off=k.toComputedLength(e[a][1].value,e[a][1].unit,null,h.styleAttrs[g.byName.fontSize.qname],null,b.pxLength.h);if(null===c.y_off)return null;if(null===e[a][2])c.b_radius=0;else if(c.b_radius=k.toComputedLength(e[a][2].value,e[a][2].unit,
null,h.styleAttrs[g.byName.fontSize.qname],null,b.pxLength.h),null===c.b_radius)return null;c.color=null===e[a][3]?h.styleAttrs[g.byName.color.qname]:e[a][3];d.push(c)}return d}),new l(h.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,function(b){return b},null),new l(h.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,function(b){return b},null),new l(h.ns_tts,"wrapOption","wrap",["span"],!0,!0,function(b){return b},null),new l(h.ns_tts,"writingMode","lrtb",["region"],!1,!0,
function(b){return b},null),new l(h.ns_tts,"zIndex","auto",["region"],!1,!0,function(b){"auto"!==b&&(b=parseInt(b),isNaN(b)&&(b=null));return b},null),new l(h.ns_ebutts,"linePadding","0c",["p"],!0,!1,k.parseLength,function(b,d,g,e,a){return k.toComputedLength(e.value,e.unit,null,null,b.cellLength.w,null)}),new l(h.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,function(b){return b},null),new l(h.ns_smpte,"backgroundImage",null,["div"],!1,!1,function(b){return b},null),new l(h.ns_itts,"forcedDisplay",
"false",["body","div","p","region","span"],!0,!0,function(b){return"true"===b?!0:!1},null),new l(h.ns_itts,"fillLineGap","true",["p"],!0,!0,function(b){return"true"===b?!0:!1},null)];g.byQName={};for(var x in g.all)g.byQName[g.all[x].qname]=g.all[x];g.byName={};for(var r in g.all)g.byName[g.all[r].name]=g.all[r]})("undefined"===typeof h?this.imscStyles={}:h,"undefined"===typeof imscNames?g("./names"):imscNames,"undefined"===typeof imscUtils?g("./utils"):imscUtils)},{"./names":5,"./utils":7}],7:[function(g,
r,h){(function(g){var h=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,k=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,l=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,r={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,
255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};g.parseColor=function(b){var d,g=null,e=r[b.toLowerCase()];void 0!==e?g=e:null!==(d=h.exec(b))?g=[parseInt(d[1],16),parseInt(d[2],16),parseInt(d[3],16),void 0!==d[4]?parseInt(d[4],16):255]:null!==(d=k.exec(b))?g=[parseInt(d[1]),parseInt(d[2]),parseInt(d[3]),255]:null!==(d=l.exec(b))&&(g=[parseInt(d[1]),parseInt(d[2]),parseInt(d[3]),parseInt(d[4])]);return g};var x=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;
g.parseLength=function(b){var d,g=null;null!==(d=x.exec(b))&&(g={value:parseFloat(d[1]),unit:d[2]});return g};g.parseTextShadow=function(b){b=b.split(",");var d=[],h;for(h in b){var e=b[h].split(" ");if(1===e.length&&"none"===e[0])return"none";if(1<e.length&&5>e.length){var a=[null,null,null,null],c=g.parseLength(e.shift());if(null===c)return null;a[0]=c;c=g.parseLength(e.shift());if(null===c)return null;a[1]=c;if(0!==e.length&&(c=g.parseLength(e[0]),null!==c&&(a[2]=c,e.shift()),0!==e.length)){e=
g.parseColor(e[0]);if(null===e)return null;a[3]=e}d.push(a)}}return d};g.parsePosition=function(b){b=b.split(" ");var d=function(a){return"center"===a||"left"===a||"top"===a||"bottom"===a||"right"===a};if(4<b.length)return null;for(var h in b)if(!d(b[h])){var e=g.parseLength(b[h]);if(null===e)return null;b[h]=e}h={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}};for(e=0;e<b.length;){var a=b[e++];if(d(a)){var c={value:0,unit:"%"};2!==b.length&&e<b.length&&!d(b[e])&&
(c=b[e++]);"right"===a?(h.h.edge=a,h.h.offset=c):"bottom"===a?(h.v.edge=a,h.v.offset=c):"left"===a?h.h.offset=c:"top"===a&&(h.v.offset=c)}else if(1===b.length||2===b.length)1===e?h.h.offset=a:h.v.offset=a;else return null}return h};g.ComputedLength=function(b,d){this.rw=b;this.rh=d};g.ComputedLength.prototype.toUsedLength=function(b,d){return b*this.rw+d*this.rh};g.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh};g.toComputedLength=function(b,d,h,e,a,c){return"%"===d&&e?
new g.ComputedLength(e.rw*b/100,e.rh*b/100):"em"===d&&h?new g.ComputedLength(h.rw*b,h.rh*b):"c"===d&&a?new g.ComputedLength(b*a.rw,b*a.rh):"px"===d&&c?new g.ComputedLength(b*c.rw,b*c.rh):"rh"===d?new g.ComputedLength(0,b/100):"rw"===d?new g.ComputedLength(b/100,0):null}})("undefined"===typeof h?this.imscUtils={}:h)},{}]},{},[4])(4)});
